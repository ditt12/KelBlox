local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

local LocalPlayer = Players.LocalPlayer
local AimKey = Enum.KeyCode.K
local Aimlock = false
local Target = nil

local function getClosestPlayer()
    local closest = nil
    local shortest = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local pos, onScreen = Camera:WorldToViewportPoint(head.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) -
                    Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude
                if dist < shortest then
                    shortest = dist
                    closest = player
                end
            end
        end
    end

    return closest
end

UserInputService.InputBegan:Connect(function(input, gp)
    if gp then return end
    if input.KeyCode == AimKey then
        Aimlock = not Aimlock
        if Aimlock then
            Target = getClosestPlayer()
        else
            Target = nil
        end
    end
end)

RunService.RenderStepped:Connect(function()
    if Aimlock and Target and Target.Character and Target.Character:FindFirstChild("Head") then
        Camera.CFrame = CFrame.new(
            Camera.CFrame.Position,
            Target.Character.Head.Position
        )
    end
end)
